# ファイル共有アプリ

このアプリは、ファイルを簡単に共有できるWebアプリケーションです。ファイルをアップロードすると、共有用のURLが生成され、そのURLを知っている人なら誰でもファイルをダウンロードできます。

## このアプリでできること

### 📤 ファイルのアップロード
- ブラウザからファイルを選択するか、ドラッグ&ドロップでファイルをアップロードできます
- アップロードしたファイルは、安全に保存されます

### ⏰ 有効期限の設定
- ファイルの有効期限を設定できます（1日、3日、5日、7日から選択）
- 有効期限が過ぎると、ファイルは自動的にダウンロードできなくなります

### 🔗 共有URLの生成
- ファイルをアップロードすると、共有用のURLが自動的に生成されます
- このURLを他の人に送ることで、ファイルを共有できます
- URLをクリックするだけで、簡単にファイルをダウンロードできます

## 使い方

### 1. ファイルをアップロードする
1. ホームページの「ここにファイルをドラッグ&ドロップ」と書かれたエリアに、ファイルをドラッグ&ドロップします
   - または、エリアをクリックしてファイルを選択します
2. ファイルが選択されると、ファイル名が表示されます
3. 有効期限を選択します（1日、3日、5日、7日から選べます）
4. 「アップロード」ボタンをクリックします

### 2. 共有URLを取得する
- アップロードが完了すると、共有URLが表示されます
- 「コピー」ボタンをクリックすると、URLがクリップボードにコピーされます
- このURLをメールやメッセージで他の人に送ります

### 3. ファイルをダウンロードする
- 共有URLをクリックすると、ファイルのダウンロードページが開きます
- 「ファイルをダウンロード」ボタンをクリックすると、ファイルがダウンロードされます
- 有効期限が切れている場合は、ダウンロードできません

## 使用技術スタック

このアプリは以下の技術を使って作られています：

### フロントエンド
- **Next.js 14.2.0**: ReactベースのWebアプリケーションフレームワーク
- **React 18.2.0**: ユーザーインターフェース構築のためのライブラリ
- **TypeScript 5**: 型安全性を提供するプログラミング言語
- **Tailwind CSS 3.4.18**: スタイリング用のCSSフレームワーク
- **react-dropzone 14.3.8**: ドラッグ&ドロップファイルアップロード機能

### バックエンド・API
- **Hono 4.10.7**: 高速なWebフレームワーク（APIルート用）
- **Drizzle ORM 0.44.7**: データベース操作のためのORM（Object-Relational Mapping）

### インフラ・クラウドサービス
- **Cloudflare Workers**: エッジコンピューティング環境
- **Cloudflare D1**: SQLiteベースのデータベース（ファイル情報を保存）
- **Cloudflare R2**: オブジェクトストレージ（実際のファイルを保存）
- **@opennextjs/cloudflare 1.11.0**: Next.jsをCloudflare Workersで実行するためのアダプター

### 開発ツール
- **Wrangler 4.51.0**: Cloudflare Workersの開発・デプロイツール
- **Drizzle Kit 0.31.7**: データベースマイグレーション管理ツール
- **ESLint**: コード品質チェックツール

## 技術的な詳細（開発者向け）

このアプリのアーキテクチャ：

- **フロントエンド**: Next.jsのApp Routerを使用したReactアプリケーション
- **API**: Honoフレームワークを使用したRESTful API
- **データベース**: Cloudflare D1（SQLite）でファイルのメタデータを管理
- **ストレージ**: Cloudflare R2で実際のファイルを保存
- **デプロイ**: Cloudflare Workers上で実行され、エッジネットワークで高速に配信

### 開発環境のセットアップ

1. 必要なソフトウェアをインストールします：
   ```bash
   npm install
   ```

2. 開発サーバーを起動します：
   ```bash
   npm run dev
   ```
   ブラウザで [http://localhost:3000](http://localhost:3000) を開きます

3. Cloudflare環境でプレビューする場合：
   ```bash
   npm run preview
   ```
   ブラウザで [http://localhost:8787](http://localhost:8787) を開きます

### デプロイ（本番環境への公開）

**重要**: 本番環境で使用するには、Cloudflareにデプロイする必要があります。

#### デプロイ前の準備

1. **Cloudflareアカウントの認証**
   ```bash
   npx wrangler login
   ```
   ブラウザが開き、Cloudflareアカウントでログインします。

2. **リモートD1データベースへのマイグレーション**
   ローカルで作成したデータベーススキーマを本番環境に適用します：
   ```bash
   npm run db:push
   ```
   または、手動でマイグレーションを実行：
   ```bash
   npx wrangler d1 execute file-share-app --remote --file=./drizzle/migrations/0000_confused_morlocks.sql
   ```

3. **R2バケットの確認**
   R2バケットが作成されているか確認します：
   ```bash
   npx wrangler r2 bucket list
   ```
   存在しない場合は作成：
   ```bash
   npx wrangler r2 bucket create file-share-app
   ```

4. **環境変数の設定**
   `.env`ファイルに設定した環境変数をCloudflareのシークレットとして設定します：
   ```bash
   npx wrangler secret put CLOUDFLARE_ACCOUNT_ID
   npx wrangler secret put CLOUDFLARE_DATABASE_ID
   npx wrangler secret put CLOUDFLARE_TOKEN
   npx wrangler secret put BASE_URL
   ```
   `BASE_URL`はデプロイ後のURL（例：`https://file-share-app.your-subdomain.workers.dev`）を設定してください。

#### デプロイの実行

準備が完了したら、以下のコマンドでデプロイします：
```bash
npm run deploy
```

このコマンドは以下を実行します：
1. Next.jsアプリケーションをビルド
2. Cloudflare Workers用に最適化
3. Cloudflare Workersにデプロイ

デプロイが完了すると、Cloudflare WorkersのURLが表示されます。そのURLが本番環境のURLになります。

#### デプロイ後の確認

1. デプロイされたURLにアクセスして、アプリが正常に動作するか確認します
2. ファイルのアップロード・ダウンロード機能をテストします
3. データベースとR2ストレージが正しく連携しているか確認します

## 注意事項

- アップロードしたファイルは、設定した有効期限が過ぎると自動的にダウンロードできなくなります
- 共有URLを知っている人なら誰でもファイルをダウンロードできるため、機密情報を含むファイルの共有には注意してください
- ファイルサイズの制限については、Cloudflare R2の制限に従います

## サポート

問題が発生した場合や質問がある場合は、プロジェクトの管理者にお問い合わせください。
